# Cargo é¡¹ç›®é…ç½®

[env]
# å¼€å‘ç¯å¢ƒå˜é‡
RUST_LOG = { value = "debug", condition = "cfg(debug_assertions)" }
RUST_BACKTRACE = { value = "1", condition = "cfg(debug_assertions)" }

# ğŸ”§ ä¿®å¤ï¼šæµ‹è¯•ç¯å¢ƒå˜é‡åªåœ¨æµ‹è¯•æ—¶ç”Ÿæ•ˆ
# DATABASE_URL = { value = "sqlite::memory:", condition = "cfg(test)" }

[target.'cfg(test)']
# æµ‹è¯•ç‰¹å®šé…ç½®
rustflags = [
    # å¯ç”¨æ›´ä¸¥æ ¼çš„æ£€æŸ¥
    "-D", "warnings",
    # ä¼˜åŒ–æµ‹è¯•ç¼–è¯‘é€Ÿåº¦
    "-C", "opt-level=0",
    # å¯ç”¨å¢é‡ç¼–è¯‘
    "-C", "incremental=true",
]

# ğŸ”§ ä¿®å¤ï¼šæµ‹è¯•ç¯å¢ƒå˜é‡é…ç½®
[target.'cfg(test)'.env]
DATABASE_URL = "sqlite::memory:"

[target.'cfg(debug_assertions)']
# å¼€å‘æ¨¡å¼é…ç½®
rustflags = [
    # å¼€å‘æ—¶çš„è­¦å‘Šè®¾ç½®
    "-W", "clippy::all",
    "-W", "clippy::pedantic",
    "-A", "clippy::module_name_repetitions",
]

[alias]
# å¸¸ç”¨å‘½ä»¤åˆ«å
t = "test"
c = "check"
r = "run"
b = "build"

# æµ‹è¯•ç›¸å…³åˆ«å
test-unit = "test --lib --bins"
test-integration = "test --test '*'"
test-doc = "test --doc"
test-all = "test --all-features --all-targets"
test-quick = "test --lib --bins --quiet"

# ä»£ç è´¨é‡æ£€æŸ¥
lint = "clippy --all-targets --all-features -- -D warnings"
fmt-check = "fmt --all -- --check"
audit = "audit"

# è¦†ç›–ç‡å’ŒåŸºå‡†æµ‹è¯•
cov = "tarpaulin --out html"
bench = "bench"

# å‘å¸ƒç›¸å…³
release-check = ["fmt-check", "lint", "test-all", "audit"]