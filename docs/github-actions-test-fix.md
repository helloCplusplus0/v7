# GitHub Actions æµ‹è¯•é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸš¨ é—®é¢˜æè¿°

åœ¨ä»£ç æ¨é€åˆ°GitHubä»“åº“åï¼ŒGitHub Actions CI/CDæµæ°´çº¿å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š

```
Error: Failed to load custom Reporter from text
Error: Process completed with exit code 1.
```

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
Vitest 1.6.1ç‰ˆæœ¬ä¸­ï¼Œ`--reporter=text` é…ç½®å·²è¢«å¼ƒç”¨ï¼Œéœ€è¦ä½¿ç”¨ `--reporter=default` æ›¿ä»£ã€‚

### é”™è¯¯æ¥æº
åœ¨ `web/package.json` çš„ `test:ci` è„šæœ¬ä¸­ï¼š
```json
"test:ci": "vitest run --coverage --reporter=json --reporter=text"
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ›´æ–° package.json é…ç½®
```json
{
  "scripts": {
    "test:ci": "vitest run --coverage --reporter=default --reporter=json --outputFile.json=./coverage/test-results.json",
    "test:coverage": "vitest run --coverage",
    "test:ui": "vitest --ui"
  }
}
```

### 2. ä¿®å¤è¦ç‚¹

#### A. Reporter é…ç½®ä¿®å¤
- âŒ **é”™è¯¯**: `--reporter=text` (å·²å¼ƒç”¨)  
- âœ… **æ­£ç¡®**: `--reporter=default` (æ–°æ ‡å‡†)

#### B. è¾“å‡ºé…ç½®ä¼˜åŒ–
- æ·»åŠ  `--outputFile.json=./coverage/test-results.json` ç¡®ä¿JSONæŠ¥å‘Šæ­£ç¡®ç”Ÿæˆ
- ç§»é™¤è¿‡æ—¶çš„å‚æ•°å’Œé…ç½®

#### C. GitHub Actions å·¥ä½œæµä¼˜åŒ–
- æ›´æ–°è¦†ç›–ç‡æŠ¥å‘Šæ”¶é›†è·¯å¾„
- ä½¿ç”¨ `actions/upload-artifact@v3` æ›¿ä»£è¿‡æ—¶çš„è¦†ç›–ç‡æœåŠ¡
- ä¼˜åŒ–é•œåƒæ ‡ç­¾ç®¡ç†

## âœ… éªŒè¯ç»“æœ

### æœ¬åœ°æµ‹è¯•æˆåŠŸ
```bash
npm run test:ci
# âœ… 159ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
# âœ… è¦†ç›–ç‡æŠ¥å‘Šæ­£å¸¸ç”Ÿæˆ
# âœ… JSONæŠ¥å‘Šè¾“å‡ºåˆ° coverage/test-results.json
```

### è¦†ç›–ç‡ç»Ÿè®¡
```
Test Files  13 passed (13)
Tests       159 passed (159)
Coverage    18.47% statements
            79.37% branches
            69.23% functions
```

### ç”Ÿæˆçš„æ–‡ä»¶
```
coverage/
â”œâ”€â”€ coverage-final.json      # V8 è¦†ç›–ç‡æ•°æ®
â”œâ”€â”€ test-results.json        # Vitest æµ‹è¯•ç»“æœ
â”œâ”€â”€ index.html              # HTML è¦†ç›–ç‡æŠ¥å‘Š
â””â”€â”€ web/                    # è¯¦ç»†è¦†ç›–ç‡æ–‡ä»¶
```

## ğŸ”§ GitHub Actions é…ç½®æ›´æ–°

### å‰ç«¯æµ‹è¯•ä»»åŠ¡ä¼˜åŒ–
```yaml
frontend-test:
  steps:
    - name: è¿è¡Œæµ‹è¯•å’Œè¦†ç›–ç‡
      run: npm run test:ci
    
    - name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: coverage-report
        path: web/coverage/
        retention-days: 7
```

### éƒ¨ç½²æµç¨‹æ”¹è¿›
- ä½¿ç”¨ `appleboy/ssh-action@v1.0.0` ç®€åŒ–SSHéƒ¨ç½²
- æ·»åŠ é•œåƒæ ‡ç­¾ç‰ˆæœ¬æ§åˆ¶ï¼ˆä½¿ç”¨ `${{ github.sha }}`ï¼‰
- å¢å¼ºå¥åº·æ£€æŸ¥å’Œå›æ»šæœºåˆ¶
- è‡ªåŠ¨æ¸…ç†æ—§é•œåƒ

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹è¿› |
|------|--------|--------|------|
| CIå¤±è´¥ç‡ | 100% | 0% | âœ… å®Œå…¨ä¿®å¤ |
| æµ‹è¯•æ‰§è¡Œæ—¶é—´ | N/A | ~6ç§’ | âš¡ é«˜æ•ˆæ‰§è¡Œ |
| è¦†ç›–ç‡æŠ¥å‘Š | âŒ æ— æ³•ç”Ÿæˆ | âœ… å®Œæ•´ç”Ÿæˆ | ğŸ“Š å¯è§†åŒ– |
| éƒ¨ç½²è‡ªåŠ¨åŒ– | âŒ ä¸­æ–­ | âœ… å…¨è‡ªåŠ¨ | ğŸš€ ç«¯åˆ°ç«¯ |

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. æµ‹è¯•è¦†ç›–ç‡æå‡
å½“å‰æ•´ä½“è¦†ç›–ç‡ä»…18.47%ï¼Œå»ºè®®é‡ç‚¹æå‡ï¼š
- ä¸»è¦ä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼ˆhooks.ts, view.tsxï¼‰
- é…ç½®ç®¡ç†æ¨¡å—
- é”™è¯¯å¤„ç†é€»è¾‘

### 2. CI/CD æµæ°´çº¿å¢å¼º
- æ·»åŠ ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆSonarQubeï¼‰
- å®ç°é‡‘ä¸é›€éƒ¨ç½²ç­–ç•¥
- é›†æˆè‡ªåŠ¨åŒ–å®‰å…¨æ‰«æ

### 3. ç›‘æ§å’Œå‘Šè­¦
- é›†æˆåº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰
- è®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
- å®ç°å¥åº·æ£€æŸ¥ä»ªè¡¨æ¿

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

### Vitest é…ç½®æœ€ä½³å®è·µ
1. **ä½¿ç”¨æœ€æ–°Reporterè¯­æ³•**ï¼š`--reporter=default` æ›¿ä»£å¼ƒç”¨çš„é…ç½®
2. **æ˜ç¡®è¾“å‡ºè·¯å¾„**ï¼šä½¿ç”¨ `--outputFile.json` æŒ‡å®šæŠ¥å‘Šä½ç½®
3. **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šåŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€CIç¯å¢ƒçš„ä¸åŒéœ€æ±‚

### GitHub Actions æœ€ä½³å®è·µ
1. **å¹¶è¡Œæ‰§è¡Œ**ï¼šå‰åç«¯æµ‹è¯•ä»»åŠ¡å¹¶è¡Œè¿è¡Œï¼Œæé«˜æ•ˆç‡
2. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ä¾èµ–ç¼“å­˜ï¼Œå‡å°‘æ„å»ºæ—¶é—´
3. **å¤±è´¥æ¢å¤**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
4. **å®‰å…¨ç®¡ç†**ï¼šä½¿ç”¨GitHub Secretsç®¡ç†æ•æ„Ÿä¿¡æ¯

### éƒ¨ç½²æœ€ä½³å®è·µ
1. **ç‰ˆæœ¬ç®¡ç†**ï¼šä½¿ç”¨Git SHAä½œä¸ºé•œåƒæ ‡ç­¾
2. **å¥åº·æ£€æŸ¥**ï¼šéƒ¨ç½²åè‡ªåŠ¨éªŒè¯æœåŠ¡å¯ç”¨æ€§
3. **èµ„æºæ¸…ç†**ï¼šå®šæœŸæ¸…ç†æ—§é•œåƒå’Œå®¹å™¨
4. **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024å¹´6æœˆ23æ—¥ 17:24  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œå…¨è§£å†³  
**å½±å“èŒƒå›´**: CI/CDæµæ°´çº¿ã€æµ‹è¯•è¦†ç›–ç‡ã€è‡ªåŠ¨åŒ–éƒ¨ç½²  
**éªŒè¯æ–¹å¼**: æœ¬åœ°æµ‹è¯• + GitHub Actions éªŒè¯ 