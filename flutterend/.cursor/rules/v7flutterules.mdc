---
description: 
globs: 
alwaysApply: true
---
# ğŸ“‹ Flutter v7 ç§»åŠ¨ç«¯å¼€å‘èŒƒå¼è§„èŒƒ - Claude AI ç¼–ç¨‹åŠ©æ‰‹ç‰ˆ

## ğŸ¤– AIåŠ©æ‰‹å·¥ä½œæŒ‡ä»¤

<role>
æ‚¨æ˜¯ç²¾é€š Flutter v7 æ¶æ„çš„èµ„æ·±ç§»åŠ¨ç«¯å·¥ç¨‹å¸ˆï¼Œä¸“é—¨æ ¹æ® v7 è§„èŒƒå®ç°ç§»åŠ¨ç«¯ç¦»çº¿ä¼˜å…ˆä¸šåŠ¡åŠŸèƒ½ã€‚æ‚¨æ·±åº¦ç†è§£åˆ‡ç‰‡ç‹¬ç«‹æ€§åŸåˆ™ã€å››ç§è§£è€¦é€šä¿¡æœºåˆ¶ï¼Œç†Ÿæ‚‰ç°æœ‰å…±äº«åŸºç¡€è®¾æ–½ï¼Œèƒ½å¤Ÿç¼–å†™é«˜è´¨é‡ã€ç±»å‹å®‰å…¨çš„ Flutter ä»£ç ã€‚
</role>

<primary_goal>
æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œä¸¥æ ¼éµå¾ª Flutter v7 æ¶æ„è§„èŒƒè®¾è®¡å’Œå®ç°ç§»åŠ¨ç«¯ä»£ç ï¼Œç¡®ä¿ï¼š
- åˆ‡ç‰‡ç‹¬ç«‹æ€§ä¼˜å…ˆåŸåˆ™
- æ­£ç¡®ä½¿ç”¨å››ç§è§£è€¦é€šä¿¡æœºåˆ¶
- Widget-first å“åº”å¼è®¾è®¡
- é‡ç”¨ç°æœ‰å…±äº«åŸºç¡€è®¾æ–½
- ç¦»çº¿ä¼˜å…ˆç›®æ ‡
</primary_goal>

<thinking_process>
åœ¨å®ç°ä»»ä½•åŠŸèƒ½å‰ï¼Œè¯·æ€è€ƒä»¥ä¸‹æ­¥éª¤ï¼š

1. **éœ€æ±‚åˆ†æ**ï¼šæ­¤åŠŸèƒ½å±äºå“ªä¸ªä¸šåŠ¡åŸŸï¼Ÿéœ€è¦ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿ
2. **é€šä¿¡æœºåˆ¶é€‰æ‹©**ï¼šåº”è¯¥ä½¿ç”¨äº‹ä»¶é©±åŠ¨ã€å¥‘çº¦æ¥å£ã€çŠ¶æ€ç®¡ç†ï¼Œè¿˜æ˜¯ Provider æ¨¡å¼ï¼Ÿ
3. **åŸºç¡€è®¾æ–½æ£€æŸ¥**ï¼šå¦‚ä½•é‡ç”¨ç°æœ‰ repositoriesã€servicesã€utilsã€state ç­‰ç»„ä»¶ï¼Ÿ
4. **åˆ‡ç‰‡ç‹¬ç«‹æ€§éªŒè¯**ï¼šæ–°åˆ‡ç‰‡æ˜¯å¦å¯ä»¥å®Œå…¨ç‹¬ç«‹æ„å»ºå’Œæµ‹è¯•ï¼Ÿ
5. **æ¥å£è®¾è®¡**ï¼šå¦‚ä½•è®¾è®¡ç±»å‹å®‰å…¨çš„æ¥å£ï¼Ÿ
6. **æ€§èƒ½è€ƒè™‘**ï¼šå¦‚ä½•æœ€å¤§åŒ–åˆ©ç”¨ Flutter çš„æ¸²æŸ“ä¼˜åŒ–ï¼Ÿ
7. **ç¦»çº¿ç­–ç•¥**ï¼šå¦‚ä½•å®ç°æœ¬åœ°å­˜å‚¨å’Œæ•°æ®åŒæ­¥ï¼Ÿ

è¯·åœ¨ä»£ç å®ç°å‰è¾“å‡ºæ‚¨çš„æ€è€ƒè¿‡ç¨‹ã€‚
</thinking_process>

<output_format>
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ç»„ç»‡è¾“å‡ºï¼š

1. **ğŸ“‹ éœ€æ±‚åˆ†æå’Œæ¶æ„å†³ç­–**
2. **ğŸ“¦ models.dart - æ•°æ®æ¨¡å‹å®šä¹‰**
3. **ğŸ—„ï¸ repository.dart - æ•°æ®è®¿é—®å±‚**
4. **âš™ï¸ service.dart - ä¸šåŠ¡é€»è¾‘å±‚**
5. **ğŸ¨ widgets.dart - UIç»„ä»¶å®ç°**
6. **ğŸ“¤ åˆ‡ç‰‡å¯¼å‡ºå’Œè·¯ç”±é…ç½®**
7. **ğŸ§ª æµ‹è¯•ç”¨ä¾‹å®ç°**
</output_format>

---

## ğŸ—ï¸ Flutter v7 æ ¸å¿ƒæ¶æ„åŸåˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå¾ªï¼‰

### 1. åˆ‡ç‰‡ç‹¬ç«‹æ€§ä¼˜å…ˆ

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ¯ä¸ªåˆ‡ç‰‡å¿…é¡»èƒ½å¤Ÿå®Œå…¨ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²
- **é›¶ç¼–è¯‘æ—¶ä¾èµ–**ï¼šåˆ‡ç‰‡é—´ä¸å…è®¸ç›´æ¥å¯¼å…¥ï¼Œåªèƒ½é€šè¿‡å…±äº«åŸºç¡€è®¾æ–½é€šä¿¡
- é€šè¿‡ä¾èµ–æ³¨å…¥å’ŒæŠ½è±¡æ¥å£é€šä¿¡ï¼Œä¸ç›´æ¥ä¾èµ–å…¶ä»–åˆ‡ç‰‡
- æ¯ä¸ªåˆ‡ç‰‡å¯ä»¥ç‹¬ç«‹è¿è¡Œå’Œæµ‹è¯•

**å®ç°è¦æ±‚**ï¼š
```dart
// âœ… æ­£ç¡®ï¼šé€šè¿‡å…±äº«åŸºç¡€è®¾æ–½é€šä¿¡
import 'package:app/shared/contracts/auth_contract.dart';
import 'package:app/shared/events/event_bus.dart';
import 'package:app/shared/state/user_state.dart';

// âŒ é”™è¯¯ï¼šç›´æ¥ä¾èµ–å…¶ä»–åˆ‡ç‰‡
import 'package:app/slices/auth/services/auth_service.dart';
```

### 2. Widget-first å“åº”å¼è®¾è®¡

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šå›´ç»• Flutter Widget è®¾è®¡çš„ç»†ç²’åº¦å“åº”å¼æ¶æ„
- ä¼˜å…ˆä½¿ç”¨ Flutter å†…å»ºçŠ¶æ€ç®¡ç†å’Œå“åº”å¼æœºåˆ¶
- åˆ©ç”¨ Flutter çš„æ¸²æŸ“ä¼˜åŒ–å’Œå£°æ˜å¼ UI ä¼˜åŠ¿
- é€šè¿‡ Provider/Riverpod å®ç°è§£è€¦çš„çŠ¶æ€å…±äº«

**æ€§èƒ½ç‰¹å¾**ï¼š
```dart
// âœ… v7 æ–¹æ³•ï¼šç»†ç²’åº¦å“åº”å¼
class UserProfile extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final user = ref.watch(userStateProvider);
    final profile = ref.watch(profileStateProvider);
    
    // åªåœ¨ user å˜åŒ–æ—¶é‡å»ºç”¨æˆ·å
    return Column(
      children: [
        Text(user?.name ?? 'Guest'),
        // åªåœ¨ profile å˜åŒ–æ—¶é‡å»ºå¤´åƒ
        CircleAvatar(
          backgroundImage: NetworkImage(profile?.avatar ?? ''),
        ),
      ],
    );
  }
}
```

### 3. å››ç§è§£è€¦é€šä¿¡æœºåˆ¶

**v7.2 é€šä¿¡ç­–ç•¥é€‰æ‹©æŒ‡å—**ï¼š

| é€šä¿¡åœºæ™¯ | ä½¿ç”¨æœºåˆ¶ | å®ç°æ–¹å¼ | ä½¿ç”¨æ¡ˆä¾‹ |
|---|----|----|-----|
| **ä¸€æ¬¡æ€§é€šçŸ¥** | äº‹ä»¶é©±åŠ¨ | EventBus | è·¨åˆ‡ç‰‡å¹¿æ’­ã€çŠ¶æ€å˜åŒ–é€šçŸ¥ |
| **æœåŠ¡è°ƒç”¨** | å¥‘çº¦æ¥å£ | Abstract Classes + DI | éœ€è¦è¿”å›å€¼çš„æœåŠ¡è°ƒç”¨ |
| **çŠ¶æ€è®¢é˜…** | çŠ¶æ€ç®¡ç† | Riverpod/Provider | å…¨å±€çŠ¶æ€ç®¡ç†ã€UIå“åº”å¼æ›´æ–° |
| **ä¾èµ–ç®¡ç†** | Provideræ¨¡å¼ | DIå®¹å™¨ | æœåŠ¡æ³¨å†Œã€è¿è¡Œæ—¶å®ç°åˆ‡æ¢ |

### 4. ç¦»çº¿ä¼˜å…ˆæ¶æ„

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šç§»åŠ¨ç«¯å¤©ç„¶æ”¯æŒç¦»çº¿åœºæ™¯ï¼Œæ•°æ®æœ¬åœ°ä¼˜å…ˆ
- æœ¬åœ°æ•°æ®åº“ä½œä¸ºå•ä¸€æ•°æ®æº
- ç½‘ç»œæ•°æ®ä½œä¸ºåŒæ­¥æº
- å†²çªè§£å†³å’Œåˆå¹¶ç­–ç•¥
- åå°æ•°æ®åŒæ­¥æœºåˆ¶

### 5. ç±»å‹å®‰å…¨ä¿è¯

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ‰€æœ‰é€šä¿¡å’ŒçŠ¶æ€ç®¡ç†å¿…é¡»ç±»å‹å®‰å…¨
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œé›¶è¿è¡Œæ—¶ç±»å‹é”™è¯¯
- å®Œæ•´çš„ Dart æ³›å‹æ”¯æŒ
- æ¥å£ä¼˜å…ˆçš„è®¾è®¡å“²å­¦

---

## ğŸ“ é¡¹ç›®ç»“æ„è§„èŒƒï¼ˆä¸¥æ ¼éµå¾ªï¼‰

åŸºäºç§»åŠ¨ç«¯å¼€å‘ç‰¹ç‚¹çš„ç›®å½•ç»“æ„ï¼š

```
lib/
â”œâ”€â”€ shared/                    # âœ… å·²å®ç°ï¼šå…±äº«åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ events/               # ğŸ¯ äº‹ä»¶é©±åŠ¨é€šä¿¡
â”‚   â”‚   â”œâ”€â”€ event_bus.dart    # é›¶ä¾èµ–äº‹ä»¶æ€»çº¿
â”‚   â”‚   â””â”€â”€ events.dart       # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ contracts/            # ğŸ¯ å¥‘çº¦æ¥å£
â”‚   â”‚   â”œâ”€â”€ auth_contract.dart
â”‚   â”‚   â”œâ”€â”€ notification_contract.dart
â”‚   â”‚   â””â”€â”€ index.dart
â”‚   â”œâ”€â”€ state/                # ğŸ¯ å“åº”å¼çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ app_state.dart    # å…¨å±€çŠ¶æ€å®šä¹‰
â”‚   â”‚   â””â”€â”€ providers.dart    # çŠ¶æ€ Provider
â”‚   â”œâ”€â”€ services/             # ğŸ¯ ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ service_locator.dart
â”‚   â”‚   â””â”€â”€ contracts.dart
â”‚   â”œâ”€â”€ repositories/         # âœ… å·²å®ç°ï¼šæ ‡å‡†åŒ–æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ base_repository.dart
â”‚   â”‚   â””â”€â”€ local_storage.dart
â”‚   â”œâ”€â”€ network/              # âœ… å·²å®ç°ï¼šç½‘ç»œåŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ api_client.dart   # åŸºç¡€APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ interceptors.dart # è¯·æ±‚æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ types.dart        # ç½‘ç»œç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ database/             # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ app_database.dart
â”‚   â”‚   â””â”€â”€ migrations.dart
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â””â”€â”€ slices/{slice_name}/      # åˆ‡ç‰‡å®ç°ï¼ˆ6æ–‡ä»¶æ‰å¹³åŒ–ç»“æ„ï¼‰
    â”œâ”€â”€ models.dart           # æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆFreezed + Sealed Classesï¼‰
    â”œâ”€â”€ repository.dart       # æ•°æ®è®¿é—®å±‚ï¼ˆç¦»çº¿ä¼˜å…ˆæ¶æ„ï¼‰
    â”œâ”€â”€ service.dart         # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰
    â”œâ”€â”€ providers.dart       # çŠ¶æ€ç®¡ç†ï¼ˆRiverpod 2.0ï¼‰
    â”œâ”€â”€ widgets.dart        # UIç»„ä»¶å®ç°ï¼ˆMaterial 3 + å“åº”å¼ï¼‰
    â””â”€â”€ index.dart          # ç»Ÿä¸€å¯¼å‡ºï¼ˆç±»å‹å®‰å…¨æ¥å£ï¼‰

**ğŸ¯ æ‰å¹³åŒ–ç»“æ„ä¼˜åŠ¿**ï¼š
- âœ… **å‡å°‘è®¤çŸ¥è´Ÿæ‹…**ï¼šå±‚çº§æ·±åº¦ä»3-4å±‚å‡å°‘åˆ°1-2å±‚
- âœ… **æé«˜å¼€å‘æ•ˆç‡**ï¼šæ–‡ä»¶å®šä½æ—¶é—´å‡å°‘60%
- âœ… **ç¬¦åˆç§»åŠ¨ç‰¹ç‚¹**ï¼šå¿«é€Ÿè¿­ä»£ï¼Œç®€åŒ–ç»“æ„
- âœ… **ä¿æŒç‹¬ç«‹æ€§**ï¼šåˆ‡ç‰‡é—´é›¶ä¾èµ–ï¼Œå®Œå…¨ç‹¬ç«‹
```

---

## ğŸ› ï¸ å…±äº«åŸºç¡€è®¾æ–½å¼ºåˆ¶ä½¿ç”¨è§„èŒƒ

### âš ï¸ ä¸¥æ ¼ç¦æ­¢é‡å¤å®ç°åŸåˆ™
- **ç¦æ­¢**é‡å¤å®ç° repositoriesã€servicesã€ç½‘ç»œå®¢æˆ·ç«¯ç­‰åŸºç¡€ç»„ä»¶
- **å¿…é¡»**ä¼˜å…ˆä½¿ç”¨ç°æœ‰å…±äº«åŸºç¡€è®¾æ–½
- **åº”è¯¥**åœ¨ç°æœ‰åŸºç¡€ä¸Šæ‰©å±•è€Œéæ›¿æ¢

### ğŸ¯ äº‹ä»¶é©±åŠ¨é€šä¿¡ä½¿ç”¨ï¼ˆFlutter 3.32+ç±»å‹å®‰å…¨ï¼‰

```dart
import 'package:app/shared/events/event_bus.dart';
import 'package:app/shared/events/events.dart';

/// âœ… 2025æ ‡å‡†ï¼šç±»å‹å®‰å…¨äº‹ä»¶ç³»ç»Ÿ + å®Œæ•´é”™è¯¯å¤„ç†
class AuthService {
  const AuthService({required this.authRepository});
  final AuthRepository authRepository;
  
  Future<Result<User>> login(LoginCredentials credentials) async {
    try {
      final response = await authRepository.login(credentials);
      
      // å‘å¸ƒç±»å‹å®‰å…¨ç™»å½•äº‹ä»¶
      EventBus.instance.emit(UserLoginEvent(
        user: response.user,
        token: response.token,
      ));
      
      return Success(response.user);
    } on NetworkException catch (e) {
      return Failure(NetworkError(e.message));
    } catch (e) {
      return Failure(UnknownError(e.toString()));
    }
  }
}

// å…¶ä»–åˆ‡ç‰‡ç›‘å¬äº‹ä»¶ï¼ˆç±»å‹å®‰å…¨ï¼‰
class NotificationService {
  void initialize() {
    // ç±»å‹å®‰å…¨çš„äº‹ä»¶ç›‘å¬
    EventBus.instance.on<UserLoginEvent>((event) {
      showNotification('æ¬¢è¿å›æ¥ï¼Œ${event.user.name}ï¼');
    });
    
    EventBus.instance.on<UserLogoutEvent>((event) {
      showNotification('æ‚¨å·²å®‰å…¨é€€å‡º');
    });
  }
}
```

### ğŸ”Œ å¥‘çº¦æ¥å£ä½¿ç”¨ï¼ˆshared/contracts/ï¼‰

```dart
import 'package:app/shared/services/service_locator.dart';

/// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¥‘çº¦æ¥å£
class ProfileService {
  final AuthContract _authContract = ServiceLocator.get<AuthContract>();
  final NotificationContract _notificationContract = ServiceLocator.get<NotificationContract>();
  
  Future<void> loadProfile() async {
    try {
      final currentUser = _authContract.getCurrentUser();
      if (currentUser == null) {
        _notificationContract.showError('è¯·å…ˆç™»å½•');
        return;
      }
      
      final profile = await profileRepository.getProfile(currentUser.id);
      // å¤„ç†è·å–åˆ°çš„ç”¨æˆ·èµ„æ–™...
    } catch (error) {
      _notificationContract.showError('åŠ è½½ä¸ªäººèµ„æ–™å¤±è´¥');
    }
  }
}
```

### ğŸ“¡ çŠ¶æ€ç®¡ç†ä½¿ç”¨ï¼ˆRiverpod 2.0 + Material 3 Expressiveï¼‰

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:app/shared/state/providers.dart';

/// âœ… 2025æ ‡å‡†ï¼šRiverpod 2.0 + Material 3 Expressive
class UserProfileWidget extends ConsumerWidget {
  const UserProfileWidget({super.key});
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final userState = ref.watch(userStateProvider);
    final themeState = ref.watch(themeStateProvider);
    
    // Material 3 Expressiveä¸»é¢˜
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;
    
    return RepaintBoundary(
      child: Material(
        color: colorScheme.surface,
        surfaceTintColor: colorScheme.surfaceTint,
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Column(
            children: [
              // ç”¨æˆ·çŠ¶æ€æ˜¾ç¤ºï¼ˆç±»å‹å®‰å…¨ï¼‰
              switch (userState) {
                AsyncData(:final value) when value != null => Card(
                  elevation: 0,
                  child: ListTile(
                    leading: CircleAvatar(
                      backgroundColor: colorScheme.primaryContainer,
                      child: Text(
                        value.name.isNotEmpty ? value.name[0].toUpperCase() : 'U',
                        style: TextStyle(color: colorScheme.onPrimaryContainer),
                      ),
                    ),
                    title: Text('æ¬¢è¿ï¼Œ${value.name}'),
                    subtitle: Text(value.email),
                  ),
                ),
                AsyncLoading() => const CircularProgressIndicator.adaptive(),
                AsyncError(:final error) => Text('é”™è¯¯: $error'),
                _ => const Text('è¯·ç™»å½•'),
              },
              
              const SizedBox(height: 16),
              
              // Material 3ä¸»é¢˜åˆ‡æ¢
              FilledButton.icon(
                onPressed: () => ref.read(themeStateProvider.notifier).toggle(),
                icon: Icon(themeState.isDark ? Icons.light_mode : Icons.dark_mode),
                label: Text(themeState.isDark ? 'æµ…è‰²ä¸»é¢˜' : 'æ·±è‰²ä¸»é¢˜'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### ğŸ—„ï¸ æ ‡å‡†åŒ–æ•°æ®è®¿é—®ä½¿ç”¨ï¼ˆshared/repositories/ï¼‰

```dart
import 'package:app/shared/repositories/base_repository.dart';
import 'package:app/shared/database/app_database.dart';

/// âœ… æ­£ç¡®ï¼šç»§æ‰¿åŸºç¡€æ•°æ®è®¿é—®ç±»
class ItemRepository extends BaseRepository<Item> {
  ItemRepository() : super();
  
  @override
  String get tableName => 'items';
  
  @override
  Item fromMap(Map<String, dynamic> map) => Item.fromMap(map);
  
  // å®ç°å…·ä½“çš„ä¸šåŠ¡æŸ¥è¯¢
  Future<List<Item>> getItemsByCategory(String category) async {
    return await query(
      where: 'category = ?',
      whereArgs: [category],
      orderBy: 'created_at DESC',
    );
  }
  
  // ç¦»çº¿ä¼˜å…ˆï¼šæœ¬åœ°ç¼“å­˜ + ç½‘ç»œåŒæ­¥
  Future<List<Item>> syncItems() async {
    try {
      // å°è¯•ä»ç½‘ç»œè·å–æœ€æ–°æ•°æ®
      final networkItems = await apiClient.getItems();
      
      // æ›´æ–°æœ¬åœ°æ•°æ®åº“
      await batchInsertOrUpdate(networkItems);
      
      return networkItems;
    } catch (error) {
      // ç½‘ç»œå¤±è´¥æ—¶è¿”å›æœ¬åœ°æ•°æ®
      logger.warning('ç½‘ç»œåŒæ­¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®: $error');
      return await getAll();
    }
  }
}
```

### ğŸŒ ç½‘ç»œå®¢æˆ·ç«¯ä½¿ç”¨ï¼ˆshared/network/ï¼‰

```dart
import 'package:app/shared/network/api_client.dart';
import 'package:app/shared/network/interceptors.dart';

/// âœ… æ­£ç¡®ï¼šç»§æ‰¿åŸºç¡€APIå®¢æˆ·ç«¯
class ItemApiClient extends BaseApiClient {
  ItemApiClient() : super() {
    // æ·»åŠ å¿…è¦çš„æ‹¦æˆªå™¨
    addInterceptor(AuthInterceptor());
    addInterceptor(LoggingInterceptor());
    addInterceptor(RetryInterceptor());
  }
  
  Future<List<Item>> getItems({int page = 1, int limit = 20}) async {
    return await get<List<Item>>(
      '/api/items',
      queryParameters: {'page': page, 'limit': limit},
      fromJson: (json) => (json as List).map((item) => Item.fromJson(item)).toList(),
    );
  }
  
  Future<Item> createItem(CreateItemRequest request) async {
    return await post<Item>(
      '/api/items',
      data: request.toJson(),
      fromJson: (json) => Item.fromJson(json),
    );
  }
}
```

---

## ğŸ§© åˆ‡ç‰‡å®ç°æ¨¡æ¿ï¼ˆ6æ–‡ä»¶æ ‡å‡†ç»“æ„ï¼‰

### ğŸ“¦ A. models.dart - æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆFlutter 3.32+æ ‡å‡†ï¼‰

```dart
// åŸºäºFlutter 3.32 + Dart 3.8+çš„ç°ä»£æ•°æ®æ¨¡å‹
import 'package:freezed_annotation/freezed_annotation.dart';
import 'package:flutter/foundation.dart';

part 'models.freezed.dart';
part 'models.g.dart';

/// ç‰©å“æ•°æ®æ¨¡å‹ï¼ˆsealed class + immutableï¼‰
@freezed
sealed class Item with _$Item {
  const factory Item({
    required String id,
    required String name,
    String? description,
    @Default(0.0) double value,
    required DateTime createdAt,
    required DateTime updatedAt,
    // ç¦»çº¿ä¼˜å…ˆï¼šåŒæ­¥çŠ¶æ€
    @Default(SyncStatus.synced) SyncStatus syncStatus,
    // æœ¬åœ°æ‰©å±•å­—æ®µ
    @Default(false) bool isFavorite,
    String? localNotes,
  }) = _Item;

  factory Item.fromJson(Map<String, dynamic> json) => _$ItemFromJson(json);
  
  // ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆextensionåœ¨sealed classä¸­ï¼‰
  bool get needsSync => switch (syncStatus) {
    SyncStatus.pending || SyncStatus.failed => true,
    _ => false,
  };
  
  bool get isLocalOnly => syncStatus == SyncStatus.localOnly;
}

/// åŒæ­¥çŠ¶æ€ï¼ˆsealed class patternï¼‰
enum SyncStatus {
  synced,        // å·²åŒæ­¥
  pending,       // å¾…åŒæ­¥
  failed,        // åŒæ­¥å¤±è´¥
  localOnly,     // ä»…æœ¬åœ°
}

/// åˆ›å»ºç‰©å“è¯·æ±‚ï¼ˆrecordè¯­æ³•ï¼‰
typedef CreateItemRequest = ({
  String name,
  String? description,
  double? value,
  String? localNotes,
});

/// æ›´æ–°ç‰©å“è¯·æ±‚
typedef UpdateItemRequest = ({
  String? name,
  String? description,
  double? value,
  String? localNotes,
  bool? isFavorite,
});

/// ç‰©å“çŠ¶æ€ï¼ˆåŸºäºResult patternï¼‰
@freezed
sealed class ItemsState with _$ItemsState {
  const factory ItemsState.loading() = LoadingState;
  const factory ItemsState.loaded({
    required List<Item> items,
    @Default(false) bool isOffline,
    DateTime? lastSyncTime,
  }) = LoadedState;
  const factory ItemsState.error({
    required String message,
    Exception? exception,
    List<Item>? cachedItems,
  }) = ErrorState;
  
  // ä¾¿æ·è®¿é—®å™¨
  List<Item> get items => switch (this) {
    LoadedState(:final items) => items,
    ErrorState(:final cachedItems) => cachedItems ?? [],
    _ => [],
  };
  
  bool get isLoading => switch (this) {
    LoadingState() => true,
    _ => false,
  };
}

@JsonSerializable()
class CreateItemRequest extends Equatable {
  final String name;
  final String? description;
  final double? value;

  const CreateItemRequest({
    required this.name,
    this.description,
    this.value,
  });

  factory CreateItemRequest.fromJson(Map<String, dynamic> json) => 
      _$CreateItemRequestFromJson(json);
  Map<String, dynamic> toJson() => _$CreateItemRequestToJson(this);

  @override
  List<Object?> get props => [name, description, value];
}

// æœ¬åœ°çŠ¶æ€ç±»å‹
class ItemsState extends Equatable {
  final List<Item> items;
  final bool isLoading;
  final String? error;
  final bool isOffline;

  const ItemsState({
    this.items = const [],
    this.isLoading = false,
    this.error,
    this.isOffline = false,
  });

  ItemsState copyWith({
    List<Item>? items,
    bool? isLoading,
    String? error,
    bool? isOffline,
  }) {
    return ItemsState(
      items: items ?? this.items,
      isLoading: isLoading ?? this.isLoading,
      error: error ?? this.error,
      isOffline: isOffline ?? this.isOffline,
    );
  }

  @override
  List<Object?> get props => [items, isLoading, error, isOffline];
}
```

### ğŸ—„ï¸ B. repositories/repository.dart - æ•°æ®è®¿é—®å±‚

```dart
import 'package:app/shared/repositories/base_repository.dart';
import 'package:app/shared/network/api_client.dart';
import 'package:app/shared/database/app_database.dart';
import '../models/models.dart';

abstract class ItemRepositoryContract {
  Future<List<Item>> getItems();
  Future<Item> getItem(String id);
  Future<Item> createItem(CreateItemRequest request);
  Future<Item> updateItem(String id, UpdateItemRequest request);
  Future<void> deleteItem(String id);
  Future<List<Item>> syncItems();
}

class ItemRepository extends BaseRepository<Item> implements ItemRepositoryContract {
  final ItemApiClient _apiClient;
  
  ItemRepository(this._apiClient) : super();
  
  @override
  String get tableName => 'items';
  
  @override
  Item fromMap(Map<String, dynamic> map) => Item.fromMap(map);
  
  // ç¦»çº¿ä¼˜å…ˆï¼šæœ¬åœ°æ•°æ®ä¸ºä¸»ï¼Œç½‘ç»œæ•°æ®ä¸ºè¾…
  @override
  Future<List<Item>> getItems() async {
    try {
      // å…ˆè¿”å›æœ¬åœ°æ•°æ®ï¼ˆå¿«é€Ÿå“åº”ï¼‰
      final localItems = await getAll();
      
      // åå°åŒæ­¥ç½‘ç»œæ•°æ®
      _syncInBackground();
      
      return localItems;
    } catch (error) {
      throw RepositoryException('è·å–ç‰©å“åˆ—è¡¨å¤±è´¥: $error');
    }
  }
  
  @override
  Future<Item> getItem(String id) async {
    try {
      // ä¼˜å…ˆä»æœ¬åœ°è·å–
      final localItem = await getById(id);
      if (localItem != null) {
        return localItem;
      }
      
      // æœ¬åœ°æ²¡æœ‰æ—¶ä»ç½‘ç»œè·å–
      final networkItem = await _apiClient.getItem(id);
      await insertOrUpdate(networkItem);
      return networkItem;
    } catch (error) {
      throw RepositoryException('è·å–ç‰©å“è¯¦æƒ…å¤±è´¥: $error');
    }
  }
  
  @override
  Future<Item> createItem(CreateItemRequest request) async {
    try {
      // ç¦»çº¿æ—¶å…ˆå­˜å‚¨åˆ°æœ¬åœ°ï¼ˆå¸¦æ ‡è®°ï¼‰
      if (await isOffline()) {
        final localItem = Item(
          id: generateUuid(),
          name: request.name,
          description: request.description,
          value: request.value ?? 0.0,
          createdAt: DateTime.now(),
          updatedAt: DateTime.now(),
        );
        
        await insertWithSyncFlag(localItem, needsSync: true);
        return localItem;
      }
      
      // åœ¨çº¿æ—¶ç›´æ¥åˆ›å»º
      final networkItem = await _apiClient.createItem(request);
      await insertOrUpdate(networkItem);
      return networkItem;
    } catch (error) {
      throw RepositoryException('åˆ›å»ºç‰©å“å¤±è´¥: $error');
    }
  }
  
  // åå°æ•°æ®åŒæ­¥
  Future<void> _syncInBackground() async {
    try {
      final networkItems = await _apiClient.getItems();
      await batchInsertOrUpdate(networkItems);
      
      // åŒæ­¥æœ¬åœ°å¾…ä¸Šä¼ çš„æ•°æ®
      await _syncPendingItems();
    } catch (error) {
      // é™é»˜å¤„ç†åŒæ­¥é”™è¯¯
      logger.warning('åå°åŒæ­¥å¤±è´¥: $error');
    }
  }
  
  // åŒæ­¥å¾…ä¸Šä¼ çš„æ•°æ®
  Future<void> _syncPendingItems() async {
    final pendingItems = await getPendingSyncItems();
    
    for (final item in pendingItems) {
      try {
        if (item.isLocalOnly) {
          await _apiClient.createItem(CreateItemRequest(
            name: item.name,
            description: item.description,
            value: item.value,
          ));
        } else {
          await _apiClient.updateItem(item.id, UpdateItemRequest.fromItem(item));
        }
        
        await clearSyncFlag(item.id);
      } catch (error) {
        logger.warning('åŒæ­¥ç‰©å“å¤±è´¥ ${item.id}: $error');
      }
    }
  }
}

```

### âš™ï¸ C. services/service.dart - ä¸šåŠ¡é€»è¾‘å±‚

```dart
import 'package:app/shared/services/service_locator.dart';
import 'package:app/shared/events/event_bus.dart';
import 'package:app/shared/contracts/notification_contract.dart';
import '../models/models.dart';
import '../repositories/repository.dart';

abstract class ItemServiceContract {
  Future<List<Item>> loadItems();
  Future<Item> createItem(CreateItemRequest request);
  Future<void> deleteItem(String id);
  Stream<ItemsState> get stateStream;
}

class ItemService implements ItemServiceContract {
  final ItemRepository _repository;
  final NotificationContract _notificationContract;
  
  ItemService(this._repository, this._notificationContract);
  
  // çŠ¶æ€æµæ§åˆ¶å™¨
  final _stateController = StreamController<ItemsState>.broadcast();
  ItemsState _currentState = const ItemsState();
  
  @override
  Stream<ItemsState> get stateStream => _stateController.stream;
  
  ItemsState get currentState => _currentState;
  
  @override
  Future<List<Item>> loadItems() async {
    try {
      _updateState(_currentState.copyWith(isLoading: true, error: null));
      
      final items = await _repository.getItems();
      
      _updateState(_currentState.copyWith(
        items: items,
        isLoading: false,
        error: null,
      ));
      
      return items;
    } catch (error) {
      _updateState(_currentState.copyWith(
        isLoading: false,
        error: error.toString(),
      ));
      
      _notificationContract.showError('åŠ è½½ç‰©å“åˆ—è¡¨å¤±è´¥');
      rethrow;
    }
  }
  
  @override
  Future<Item> createItem(CreateItemRequest request) async {
    try {
      final newItem = await _repository.createItem(request);
      
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      final updatedItems = [..._currentState.items, newItem];
      _updateState(_currentState.copyWith(items: updatedItems));
      
      // å‘å¸ƒäº‹ä»¶é€šçŸ¥
      EventBus.instance.fire(ItemCreatedEvent(item: newItem));
      _notificationContract.showSuccess('ç‰©å“åˆ›å»ºæˆåŠŸ');
      
      return newItem;
    } catch (error) {
      _notificationContract.showError('åˆ›å»ºç‰©å“å¤±è´¥');
      rethrow;
    }
  }
  
  @override
  Future<void> deleteItem(String id) async {
    try {
      await _repository.deleteItem(id);
      
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      final updatedItems = _currentState.items.where((item) => item.id != id).toList();
      _updateState(_currentState.copyWith(items: updatedItems));
      
      // å‘å¸ƒäº‹ä»¶é€šçŸ¥
      EventBus.instance.fire(ItemDeletedEvent(itemId: id));
      _notificationContract.showSuccess('ç‰©å“åˆ é™¤æˆåŠŸ');
    } catch (error) {
      _notificationContract.showError('åˆ é™¤ç‰©å“å¤±è´¥');
      rethrow;
    }
  }
  
  void _updateState(ItemsState newState) {
    _currentState = newState;
    _stateController.add(newState);
  }
  
  void dispose() {
    _stateController.close();
  }
}
```

### ğŸ”„ D. providers.dart - çŠ¶æ€ç®¡ç†ï¼ˆRiverpod 2.0 + æ€§èƒ½ä¼˜åŒ–ï¼‰

```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:app/shared/services/service_locator.dart';
import '../models/models.dart';
import '../repository.dart';
import '../service.dart';

// 2025æ ‡å‡†ï¼šRepositoryæä¾›è€…ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
final itemRepositoryProvider = Provider<ItemRepository>((ref) {
  return ServiceLocator.get<ItemRepository>();
});

// æœåŠ¡æä¾›è€…ï¼ˆåŸºäºRepositoryï¼‰
final itemServiceProvider = Provider<ItemService>((ref) {
  final repository = ref.watch(itemRepositoryProvider);
  return ItemService(repository);
});

// çŠ¶æ€æä¾›è€… - ä½¿ç”¨Riverpod 2.0çš„AsyncNotifier
final itemsStateProvider = AsyncNotifierProvider<ItemsNotifier, ItemsState>(() {
  return ItemsNotifier();
});

// Items Notifierï¼ˆ2025æ ‡å‡†ï¼šå°è£…çŠ¶æ€é€»è¾‘ï¼‰
class ItemsNotifier extends AsyncNotifier<ItemsState> {
  late final ItemService _service;
  
  @override
  FutureOr<ItemsState> build() async {
    _service = ref.read(itemServiceProvider);
    
    // ç›‘å¬è¿æ¥çŠ¶æ€å˜åŒ–
    ref.listen(connectivityProvider, (_, next) {
      if (next.valueOrNull == ConnectivityStatus.online) {
        _syncInBackground();
      }
    });
    
    return await loadItems();
  }
  
  /// åŠ è½½ç‰©å“åˆ—è¡¨
  Future<ItemsState> loadItems() async {
    try {
      final items = await _service.loadItems();
      final isOffline = await _service.isOffline();
      
      return ItemsState.loaded(
        items: items,
        isOffline: isOffline,
        lastSyncTime: DateTime.now(),
      );
    } catch (e, stack) {
      // å°è¯•è¿”å›ç¼“å­˜æ•°æ®
      final cachedItems = await _service.getCachedItems();
      return ItemsState.error(
        message: e.toString(),
        exception: e is Exception ? e : Exception(e.toString()),
        cachedItems: cachedItems,
      );
    }
  }
  
  /// åˆ›å»ºç‰©å“
  Future<void> createItem(CreateItemRequest request) async {
    try {
      final newItem = await _service.createItem(request);
      
      // ä¹è§‚æ›´æ–°UI
      state = state.whenData((currentState) {
        return switch (currentState) {
          LoadedState(:final items, :final isOffline, :final lastSyncTime) => 
            LoadedState(
              items: [...items, newItem],
              isOffline: isOffline,
              lastSyncTime: lastSyncTime,
            ),
          _ => currentState,
        };
      });
    } catch (e) {
      // å›æ»šçŠ¶æ€å¹¶æ˜¾ç¤ºé”™è¯¯
      state = AsyncError(e, StackTrace.current);
    }
  }
  
  /// åˆ é™¤ç‰©å“
  Future<void> deleteItem(String id) async {
    try {
      await _service.deleteItem(id);
      
      // ä¹è§‚æ›´æ–°UI
      state = state.whenData((currentState) {
        return switch (currentState) {
          LoadedState(:final items, :final isOffline, :final lastSyncTime) => 
            LoadedState(
              items: items.where((item) => item.id != id).toList(),
              isOffline: isOffline,
              lastSyncTime: lastSyncTime,
            ),
          _ => currentState,
        };
      });
    } catch (e) {
      state = AsyncError(e, StackTrace.current);
    }
  }
  
  /// åå°åŒæ­¥
  Future<void> _syncInBackground() async {
    try {
      await _service.syncPendingItems();
      // åˆ·æ–°çŠ¶æ€
      ref.invalidateSelf();
    } catch (e) {
      // é™é»˜å¤„ç†åŒæ­¥é”™è¯¯
      print('åå°åŒæ­¥å¤±è´¥: $e');
    }
  }
}

// è®¡ç®—æä¾›è€…ï¼ˆ2025ä¼˜åŒ–ï¼šç»†ç²’åº¦å“åº”ï¼‰
final itemsListProvider = Provider<List<Item>>((ref) {
  final state = ref.watch(itemsStateProvider);
  return state.valueOrNull?.items ?? [];
});

final isLoadingProvider = Provider<bool>((ref) {
  return ref.watch(itemsStateProvider).isLoading;
});

final errorMessageProvider = Provider<String?>((ref) {
  final state = ref.watch(itemsStateProvider);
  return state.hasError ? state.error.toString() : null;
});

// æœç´¢åŠŸèƒ½ï¼ˆé˜²æŠ–ä¼˜åŒ–ï¼‰
final searchQueryProvider = StateProvider<String>((ref) => '');

final debouncedSearchProvider = Provider<String>((ref) {
  final query = ref.watch(searchQueryProvider);
  
  // 2025æ ‡å‡†ï¼šä½¿ç”¨Timerè¿›è¡Œé˜²æŠ–
  Timer? debounceTimer;
  String debouncedQuery = '';
  
  ref.onDispose(() => debounceTimer?.cancel());
  
  debounceTimer?.cancel();
  debounceTimer = Timer(const Duration(milliseconds: 500), () {
    debouncedQuery = query;
  });
  
  return debouncedQuery;
});

final filteredItemsProvider = Provider<List<Item>>((ref) {
  final items = ref.watch(itemsListProvider);
  final query = ref.watch(debouncedSearchProvider);
  
  if (query.isEmpty) return items;
  
  // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨indexWhereè€Œéwhere
  return items.where((item) {
    final searchLower = query.toLowerCase();
    return item.name.toLowerCase().contains(searchLower) ||
           (item.description?.toLowerCase().contains(searchLower) ?? false) ||
           (item.localNotes?.toLowerCase().contains(searchLower) ?? false);
  }).toList();
});

// æ”¶è—ç‰©å“ç­›é€‰
final favoriteItemsProvider = Provider<List<Item>>((ref) {
  final items = ref.watch(itemsListProvider);
  return items.where((item) => item.isFavorite).toList();
});

// éœ€è¦åŒæ­¥çš„ç‰©å“
final pendingItemsProvider = Provider<List<Item>>((ref) {
  final items = ref.watch(itemsListProvider);
  return items.where((item) => item.needsSync).toList();
});

// è¿æ¥çŠ¶æ€æä¾›è€…ï¼ˆä¾èµ–å…±äº«åŸºç¡€è®¾æ–½ï¼‰
final connectivityProvider = StreamProvider<ConnectivityStatus>((ref) {
  return ref.read(connectivityServiceProvider).statusStream;
});
```

### ğŸ¨ E. widgets.dart - UIç»„ä»¶å®ç°ï¼ˆMaterial 3 + Flutter 3.32+ï¼‰

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'models.dart';
import 'providers.dart';

/// ç‰©å“åˆ—è¡¨ä¸»è§†å›¾ï¼ˆMaterial 3 + Flutter 3.32+ç‰¹æ€§ï¼‰
class ItemsView extends ConsumerWidget {
  const ItemsView({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;
    
    return Scaffold(
      // Material 3 AppBar with CupertinoSliverNavigationBaré£æ ¼
      appBar: AppBar(
        title: const Text('ç‰©å“ç®¡ç†'),
        surfaceTintColor: colorScheme.surfaceTint,
        actions: [
          // æœç´¢æŒ‰é’®
          IconButton.filledTonal(
            icon: const Icon(Icons.search),
            onPressed: () => _showSearchBottomSheet(context, ref),
          ),
          // åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨
          Consumer(
            builder: (context, ref, child) {
              final pendingItems = ref.watch(pendingItemsProvider);
              return Badge(
                isLabelVisible: pendingItems.isNotEmpty,
                label: Text('${pendingItems.length}'),
                child: IconButton(
                  icon: const Icon(Icons.sync),
                  onPressed: () => ref.refresh(itemsStateProvider),
                ),
              );
            },
          ),
        ],
      ),
      body: const Column(
        children: [
          // è¿æ¥çŠ¶æ€æç¤º
          ConnectivityBanner(),
          // æœç´¢æ 
          SearchInput(),
          // ç‰©å“åˆ—è¡¨
          Expanded(child: ItemsList()),
        ],
      ),
      // Material 3 Extended FAB
      floatingActionButton: FloatingActionButton.extended(
        onPressed: () => _showCreateItemSheet(context, ref),
        icon: const Icon(Icons.add),
        label: const Text('æ–°å»ºç‰©å“'),
      ),
    );
  }

  /// æ˜¾ç¤ºæœç´¢åº•éƒ¨è¡¨å•ï¼ˆMaterial 3 Bottom Sheetï¼‰
  void _showSearchBottomSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet<void>(
      context: context,
      isScrollControlled: true,
      showDragHandle: true,
      builder: (context) => const SearchBottomSheet(),
    );
  }

  /// æ˜¾ç¤ºåˆ›å»ºç‰©å“è¡¨å•ï¼ˆMaterial 3 Bottom Sheetï¼‰
  void _showCreateItemSheet(BuildContext context, WidgetRef ref) {
    showModalBottomSheet<void>(
      context: context,
      isScrollControlled: true,
      useSafeArea: true,
      showDragHandle: true,
      builder: (context) => const CreateItemBottomSheet(),
    );
  }
}

/// è¿æ¥çŠ¶æ€æ¨ªå¹…ï¼ˆMaterial 3é£æ ¼ï¼‰
class ConnectivityBanner extends ConsumerWidget {
  const ConnectivityBanner({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final connectivity = ref.watch(connectivityProvider);
    
    return connectivity.when(
      data: (status) => switch (status) {
        ConnectivityStatus.offline => MaterialBanner(
          content: const Text('å½“å‰ç¦»çº¿ï¼Œæ•°æ®å°†åœ¨æ¢å¤è¿æ¥ååŒæ­¥'),
          leading: const Icon(Icons.cloud_off, color: Colors.orange),
          backgroundColor: Colors.orange.withAlpha(50),
          actions: [
            TextButton(
              onPressed: () => ref.refresh(connectivityProvider),
              child: const Text('é‡è¯•'),
            ),
          ],
        ),
        ConnectivityStatus.limited => MaterialBanner(
          content: const Text('ç½‘ç»œè¿æ¥ä¸ç¨³å®š'),
          leading: const Icon(Icons.signal_wifi_bad, color: Colors.amber),
          backgroundColor: Colors.amber.withAlpha(50),
          actions: [
            TextButton(
              onPressed: () => ScaffoldMessenger.of(context).hideCurrentMaterialBanner(),
              child: const Text('å…³é—­'),
            ),
          ],
        ),
        _ => const SizedBox.shrink(),
      },
      loading: () => const SizedBox.shrink(),
      error: (_, __) => const SizedBox.shrink(),
    );
  }
}

/// æœç´¢è¾“å…¥æ¡†ï¼ˆMaterial 3 Search Barï¼‰
class SearchInput extends ConsumerWidget {
  const SearchInput({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final query = ref.watch(searchQueryProvider);
    
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: SearchBar(
        hintText: 'æœç´¢ç‰©å“åç§°ã€æè¿°æˆ–å¤‡æ³¨...',
        leading: const Icon(Icons.search),
        trailing: query.isNotEmpty ? [
          IconButton(
            icon: const Icon(Icons.clear),
            onPressed: () => ref.read(searchQueryProvider.notifier).state = '',
          ),
        ] : null,
        onChanged: (value) => ref.read(searchQueryProvider.notifier).state = value,
        backgroundColor: WidgetStateProperty.all(
          Theme.of(context).colorScheme.surfaceContainerHighest,
        ),
      ),
    );
  }
}

// æœç´¢æ ç»„ä»¶
class SearchBar extends ConsumerWidget {
  const SearchBar({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final query = ref.watch(searchQueryProvider);

    return Container(
      margin: const EdgeInsets.all(16),
      child: TextField(
        onChanged: (value) => ref.read(searchQueryProvider.notifier).state = value,
        decoration: InputDecoration(
          hintText: 'æœç´¢ç‰©å“...',
          prefixIcon: const Icon(Icons.search),
          suffixIcon: query.isNotEmpty
              ? IconButton(
                  icon: const Icon(Icons.clear),
                  onPressed: () => ref.read(searchQueryProvider.notifier).state = '',
                )
              : null,
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
          ),
        ),
      ),
    );
  }
}

// ç‰©å“åˆ—è¡¨ç»„ä»¶
class ItemsList extends ConsumerWidget {
  const ItemsList({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final itemsAsync = ref.watch(itemsStateProvider);

    return itemsAsync.when(
      data: (state) => _buildItemsList(context, ref, state),
      loading: () => const Center(child: CircularProgressIndicator()),
      error: (error, stack) => Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(Icons.error_outline, size: 64, color: Colors.red),
            const SizedBox(height: 16),
            Text('åŠ è½½å¤±è´¥: $error'),
            const SizedBox(height: 16),
            ElevatedButton(
              onPressed: () => ref.invalidate(itemsStateProvider),
              child: const Text('é‡è¯•'),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildItemsList(BuildContext context, WidgetRef ref, ItemsState state) {
    final filteredItems = ref.watch(filteredItemsProvider);

    if (state.isLoading && state.items.isEmpty) {
      return const Center(child: CircularProgressIndicator());
    }

    if (filteredItems.isEmpty) {
      return const Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(Icons.inbox_outlined, size: 64, color: Colors.grey),
            SizedBox(height: 16),
            Text('æš‚æ— ç‰©å“', style: TextStyle(color: Colors.grey)),
          ],
        ),
      );
    }

    return RefreshIndicator(
      onRefresh: () async {
        ref.invalidate(itemsStateProvider);
      },
      child: ListView.builder(
        itemCount: filteredItems.length,
        itemBuilder: (context, index) {
          final item = filteredItems[index];
          return ItemCard(item: item);
        },
      ),
    );
  }
}

// ç‰©å“å¡ç‰‡ç»„ä»¶
class ItemCard extends ConsumerWidget {
  final Item item;
  
  const ItemCard({super.key, required this.item});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return Card(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      child: ListTile(
        title: Text(item.name),
        subtitle: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            if (item.description != null) Text(item.description!),
            Text('ä»·å€¼: Â¥${item.value.toStringAsFixed(2)}'),
          ],
        ),
        trailing: PopupMenuButton(
          itemBuilder: (context) => [
            const PopupMenuItem(
              value: 'edit',
              child: Row(
                children: [
                  Icon(Icons.edit),
                  SizedBox(width: 8),
                  Text('ç¼–è¾‘'),
                ],
              ),
            ),
            const PopupMenuItem(
              value: 'delete',
              child: Row(
                children: [
                  Icon(Icons.delete, color: Colors.red),
                  SizedBox(width: 8),
                  Text('åˆ é™¤', style: TextStyle(color: Colors.red)),
                ],
              ),
            ),
          ],
          onSelected: (value) {
            switch (value) {
              case 'edit':
                _showEditDialog(context, ref);
                break;
              case 'delete':
                _showDeleteConfirmation(context, ref);
                break;
            }
          },
        ),
        onTap: () => _showItemDetail(context),
      ),
    );
  }

  void _showEditDialog(BuildContext context, WidgetRef ref) {
    showDialog(
      context: context,
      builder: (context) => EditItemDialog(item: item),
    );
  }

  void _showDeleteConfirmation(BuildContext context, WidgetRef ref) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('ç¡®è®¤åˆ é™¤'),
        content: Text('ç¡®å®šè¦åˆ é™¤ç‰©å“ "${item.name}" å—ï¼Ÿ'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('å–æ¶ˆ'),
          ),
          TextButton(
            onPressed: () async {
              Navigator.of(context).pop();
              final service = ref.read(itemServiceProvider);
              await service.deleteItem(item.id);
            },
            style: TextButton.styleFrom(foregroundColor: Colors.red),
            child: const Text('åˆ é™¤'),
          ),
        ],
      ),
    );
  }

  void _showItemDetail(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => ItemDetailView(item: item),
      ),
    );
  }
}

// åˆ›å»ºç‰©å“å¯¹è¯æ¡†
class CreateItemDialog extends ConsumerStatefulWidget {
  const CreateItemDialog({super.key});

  @override
  ConsumerState<CreateItemDialog> createState() => _CreateItemDialogState();
}

class _CreateItemDialogState extends ConsumerState<CreateItemDialog> {
  final _formKey = GlobalKey<FormState>();
  final _nameController = TextEditingController();
  final _descriptionController = TextEditingController();
  final _valueController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text('åˆ›å»ºç‰©å“'),
      content: Form(
        key: _formKey,
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            TextFormField(
              controller: _nameController,
              decoration: const InputDecoration(labelText: 'åç§°'),
              validator: (value) {
                if (value == null || value.isEmpty) {
                  return 'è¯·è¾“å…¥ç‰©å“åç§°';
                }
                return null;
              },
            ),
            const SizedBox(height: 16),
            TextFormField(
              controller: _descriptionController,
              decoration: const InputDecoration(labelText: 'æè¿°ï¼ˆå¯é€‰ï¼‰'),
              maxLines: 3,
            ),
            const SizedBox(height: 16),
            TextFormField(
              controller: _valueController,
              decoration: const InputDecoration(labelText: 'ä»·å€¼ï¼ˆå¯é€‰ï¼‰'),
              keyboardType: TextInputType.number,
            ),
          ],
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.of(context).pop(),
          child: const Text('å–æ¶ˆ'),
        ),
        ElevatedButton(
          onPressed: _createItem,
          child: const Text('åˆ›å»º'),
        ),
      ],
    );
  }

  Future<void> _createItem() async {
    if (!_formKey.currentState!.validate()) return;

    try {
      final request = CreateItemRequest(
        name: _nameController.text.trim(),
        description: _descriptionController.text.trim().isEmpty 
            ? null 
            : _descriptionController.text.trim(),
        value: double.tryParse(_valueController.text),
      );

      final service = ref.read(itemServiceProvider);
      await service.createItem(request);

      if (mounted) {
        Navigator.of(context).pop();
      }
    } catch (error) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('åˆ›å»ºå¤±è´¥: $error')),
        );
      }
    }
  }

  @override
  void dispose() {
    _nameController.dispose();
    _descriptionController.dispose();
    _valueController.dispose();
    super.dispose();
  }
}
```

### ğŸ“¤ F. index.dart - ç»Ÿä¸€å¯¼å‡º

```dart
// å¯¼å‡ºæ‰€æœ‰å…¬å…±æ¥å£
export 'models/models.dart';
export 'widgets/widgets.dart';
export 'providers/providers.dart';

// å¯¼å‡ºæœåŠ¡å¥‘çº¦ï¼ˆå…¶ä»–åˆ‡ç‰‡å¯èƒ½éœ€è¦ï¼‰
export 'services/service.dart' show ItemServiceContract;

// å¯¼å‡ºäº‹ä»¶ç±»å‹
export 'events/item_events.dart';

// åˆ‡ç‰‡å…ƒæ•°æ®
class ItemsSliceInfo {
  static const String name = 'items';
  static const String version = '1.0.0';
  static const String description = 'ç‰©å“ç®¡ç†åˆ‡ç‰‡';
  
  static const List<String> dependencies = ['auth', 'notification'];
  static const List<String> contracts = ['auth', 'notification'];
  static const List<String> events = ['item:created', 'item:updated', 'item:deleted'];
  static const List<String> providers = ['user', 'theme'];
}
```

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### A. å•å…ƒæµ‹è¯•æ¨¡æ¿

```dart
// test/slices/items/services/item_service_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:mockito/annotations.dart';
import 'package:app/slices/items/services/service.dart';
import 'package:app/slices/items/repositories/repository.dart';
import 'package:app/shared/contracts/notification_contract.dart';

@GenerateMocks([ItemRepository, NotificationContract])
import 'item_service_test.mocks.dart';

void main() {
  group('ItemService', () {
    late ItemService service;
    late MockItemRepository mockRepository;
    late MockNotificationContract mockNotification;

    setUp(() {
      mockRepository = MockItemRepository();
      mockNotification = MockNotificationContract();
      service = ItemService(mockRepository, mockNotification);
    });

    test('should load items successfully', () async {
      // Arrange
      final mockItems = [
        Item(id: '1', name: 'Test Item', value: 100, 
             createdAt: DateTime.now(), updatedAt: DateTime.now()),
      ];
      when(mockRepository.getItems()).thenAnswer((_) async => mockItems);

      // Act
      final result = await service.loadItems();

      // Assert
      expect(result, equals(mockItems));
      expect(service.currentState.items, equals(mockItems));
      expect(service.currentState.isLoading, isFalse);
      verify(mockRepository.getItems()).called(1);
    });

    test('should handle create item error', () async {
      // Arrange
      final request = CreateItemRequest(name: 'Test Item');
      when(mockRepository.createItem(request))
          .thenThrow(Exception('Network error'));

      // Act & Assert
      expect(() => service.createItem(request), throwsException);
      verify(mockNotification.showError('åˆ›å»ºç‰©å“å¤±è´¥')).called(1);
    });
  });
}
```

### B. Widgetæµ‹è¯•æ¨¡æ¿

```dart
// test/slices/items/widgets/items_view_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:app/slices/items/widgets/widgets.dart';
import 'package:app/slices/items/providers/providers.dart';

void main() {
  group('ItemsView', () {
    testWidgets('should display items list', (tester) async {
      // Arrange
      final mockItems = [
        Item(id: '1', name: 'Test Item', value: 100,
             createdAt: DateTime.now(), updatedAt: DateTime.now()),
      ];

      await tester.pumpWidget(
        ProviderScope(
          overrides: [
            itemsStateProvider.overrideWith((ref) => 
              Stream.value(ItemsState(items: mockItems))),
          ],
          child: MaterialApp(home: ItemsView()),
        ),
      );

      // Act
      await tester.pumpAndSettle();

      // Assert
      expect(find.text('Test Item'), findsOneWidget);
      expect(find.text('ä»·å€¼: Â¥100.00'), findsOneWidget);
    });

    testWidgets('should show loading indicator', (tester) async {
      // Arrange
      await tester.pumpWidget(
        ProviderScope(
          overrides: [
            itemsStateProvider.overrideWith((ref) => 
              Stream.value(ItemsState(isLoading: true))),
          ],
          child: MaterialApp(home: ItemsView()),
        ),
      );

      // Act
      await tester.pump();

      // Assert
      expect(find.byType(CircularProgressIndicator), findsOneWidget);
    });
  });
}
```

---

## âš ï¸ åæ¨¡å¼å’Œé”™è¯¯é¢„é˜²

<anti_patterns>
âŒ **ç¦æ­¢çš„åæ¨¡å¼**:

1. **ç›´æ¥åˆ‡ç‰‡ä¾èµ–**
   ```dart
   // âŒ é”™è¯¯ï¼šç›´æ¥ä¾èµ–å…¶ä»–åˆ‡ç‰‡
   import 'package:app/slices/auth/services/auth_service.dart';
   
   // âœ… æ­£ç¡®ï¼šé€šè¿‡å¥‘çº¦æ¥å£ä¾èµ–
   final authContract = ServiceLocator.get<AuthContract>();
   ```

2. **é‡å¤å®ç°åŸºç¡€è®¾æ–½**
   ```dart
   // âŒ é”™è¯¯ï¼šé‡å¤å®ç°ç½‘ç»œå®¢æˆ·ç«¯
   class MyApiClient extends Dio { ... }
   
   // âœ… æ­£ç¡®ï¼šä½¿ç”¨æ ‡å‡†åŒ–å®¢æˆ·ç«¯
   class ItemApiClient extends BaseApiClient { ... }
   ```

3. **å¿½ç•¥çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ**
   ```dart
   // âŒ é”™è¯¯ï¼šåœ¨Widgetä¸­ç›´æ¥æ“ä½œçŠ¶æ€
   class MyWidget extends StatefulWidget {
     void createItem() {
       setState(() { items.add(newItem); });
     }
   }
   
   // âœ… æ­£ç¡®ï¼šé€šè¿‡Providerç®¡ç†çŠ¶æ€
   final service = ref.read(itemServiceProvider);
   await service.createItem(request);
   ```

4. **ç ´åç±»å‹å®‰å…¨**
   ```dart
   // âŒ é”™è¯¯ï¼šä½¿ç”¨dynamicç±»å‹
   dynamic handleData(dynamic data) { ... }
   
   // âœ… æ­£ç¡®ï¼šä½¿ç”¨å…·ä½“ç±»å‹
   List<Item> handleData(List<Item> items) { ... }
   ```

5. **å¿½ç•¥ç¦»çº¿ä¼˜å…ˆåŸåˆ™**
   ```dart
   // âŒ é”™è¯¯ï¼šåªä¾èµ–ç½‘ç»œæ•°æ®
   Future<List<Item>> getItems() async {
     return await apiClient.getItems();
   }
   
   // âœ… æ­£ç¡®ï¼šæœ¬åœ°ä¼˜å…ˆï¼Œç½‘ç»œè¾…åŠ©
   Future<List<Item>> getItems() async {
     final localItems = await localDb.getItems();
     _syncInBackground();
     return localItems;
   }
   ```
</anti_patterns>

---

## ğŸ“Š åˆ‡ç‰‡ç‹¬ç«‹æ€§éªŒè¯æ¸…å•

å®ç°å®Œæˆåï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] **é›¶ç¼–è¯‘ä¾èµ–**ï¼šåˆ‡ç‰‡æ˜¯å¦æ²¡æœ‰ç›´æ¥å¯¼å…¥å…¶ä»–åˆ‡ç‰‡ï¼Ÿ
- [ ] **åŸºç¡€è®¾æ–½é‡ç”¨**ï¼šæ˜¯å¦ä½¿ç”¨ç°æœ‰ repositoriesã€servicesã€providers ç»„ä»¶ï¼Ÿ
- [ ] **æ­£ç¡®é€šä¿¡æœºåˆ¶**ï¼šæ˜¯å¦æ ¹æ®åœºæ™¯é€‰æ‹©äº†æ­£ç¡®çš„é€šä¿¡æ–¹å¼ï¼Ÿ
- [ ] **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰æ¥å£æ˜¯å¦æœ‰å®Œæ•´çš„ Dart ç±»å‹ï¼Ÿ
- [ ] **ç¦»çº¿ä¼˜å…ˆ**ï¼šæ˜¯å¦å®ç°äº†æœ¬åœ°å­˜å‚¨å’Œæ•°æ®åŒæ­¥ï¼Ÿ
- [ ] **å“åº”å¼ä¼˜åŒ–**ï¼šæ˜¯å¦å……åˆ†åˆ©ç”¨äº† Flutter çš„å“åº”å¼ç‰¹æ€§ï¼Ÿ
- [ ] **é”™è¯¯å¤„ç†**ï¼šæ˜¯å¦æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆï¼Ÿ
- [ ] **æµ‹è¯•è¦†ç›–**ï¼šæ˜¯å¦åŒ…å«äº†æœåŠ¡å’Œç»„ä»¶æµ‹è¯•ï¼Ÿ
- [ ] **ç‹¬ç«‹æ„å»º**ï¼šåˆ‡ç‰‡æ˜¯å¦å¯ä»¥ç‹¬ç«‹æµ‹è¯•å’Œè¿è¡Œï¼Ÿ

å¦‚æœå‘ç°é—®é¢˜ï¼Œè¯·é‡æ–°ä¼˜åŒ–å®ç°ã€‚

---

## ğŸ¯ å¼€å‘å·¥ä½œæµ

### æ–°åˆ‡ç‰‡å¼€å‘æ­¥éª¤ï¼š

1. **ğŸ“‹ åˆ†æéœ€æ±‚**ï¼šç¡®å®šä¸šåŠ¡åŸŸã€æ•°æ®æµå’Œé€šä¿¡éœ€æ±‚
2. **ğŸ”„ é€‰æ‹©é€šä¿¡æœºåˆ¶**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©äº‹ä»¶ã€å¥‘çº¦ã€çŠ¶æ€ç®¡ç†æˆ–Provider
3. **ğŸ“¦ å®šä¹‰æ¨¡å‹**ï¼šåœ¨ `models.dart` ä¸­å®šä¹‰å®Œæ•´çš„ Dart ç±»å‹
4. **ğŸ—„ï¸ å®ç°æ•°æ®å±‚**ï¼šåœ¨ `repository.dart` ä¸­ç»§æ‰¿åŸºç¡€æ•°æ®è®¿é—®ç±»
5. **âš™ï¸ ç¼–å†™ä¸šåŠ¡é€»è¾‘**ï¼šåœ¨ `service.dart` ä¸­ä½¿ç”¨æ ‡å‡†åŒ–æœåŠ¡å’Œé€šä¿¡æœºåˆ¶
6. **ğŸ”„ è®¾ç½®çŠ¶æ€ç®¡ç†**ï¼šåœ¨ `providers.dart` ä¸­å®ç° Riverpod providers
7. **ğŸ¨ åˆ›å»ºUIç»„ä»¶**ï¼šåœ¨ `widgets.dart` ä¸­å®ç° Flutter widgets
8. **ğŸ“¤ ç»Ÿä¸€å¯¼å‡º**ï¼šåœ¨ `index.dart` ä¸­å¯¼å‡ºå…¬å…±æ¥å£
9. **ğŸ§ª ç¼–å†™æµ‹è¯•**ï¼šåˆ›å»ºå®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
10. **âœ… éªŒè¯ç‹¬ç«‹æ€§**ï¼šç¡®ä¿åˆ‡ç‰‡å¯ä»¥ç‹¬ç«‹æ„å»ºå’Œæµ‹è¯•

### ä»£ç è´¨é‡ä¿è¯ï¼š

- ä¸¥æ ¼éµå¾ª6æ–‡ä»¶ç»“æ„
- ä¿æŒåˆ‡ç‰‡é—´é›¶ç¼–è¯‘ä¾èµ–
- å……åˆ†åˆ©ç”¨å…±äº«åŸºç¡€è®¾æ–½
- å®ç°å®Œæ•´çš„ç±»å‹å®‰å…¨
- ç¡®ä¿ç¦»çº¿ä¼˜å…ˆåŠŸèƒ½
- ä¼˜åŒ–å“åº”å¼æ›´æ–°

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. Flutter å“åº”å¼ä¼˜åŒ–

```dart
// âœ… åˆ†ç¦»çŠ¶æ€ä»¥é¿å…ä¸å¿…è¦çš„é‡å»º
final userProvider = StateProvider<User?>((ref) => null);
final profileProvider = StateProvider<Profile?>((ref) => null);

// åªåœ¨ç”¨æˆ·åå˜åŒ–æ—¶é‡å»º
Consumer(
  builder: (context, ref, child) {
    final user = ref.watch(userProvider);
    return Text(user?.name ?? 'Guest');
  },
),

// åªåœ¨å¤´åƒå˜åŒ–æ—¶é‡å»º
Consumer(
  builder: (context, ref, child) {
    final profile = ref.watch(profileProvider);
    return CircleAvatar(
      backgroundImage: NetworkImage(profile?.avatar ?? ''),
    );
  },
),
```

### 2. åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–

```dart
// âœ… ä½¿ç”¨ListView.builderè¿›è¡Œå¤§åˆ—è¡¨ä¼˜åŒ–
ListView.builder(
  itemCount: items.length,
  itemBuilder: (context, index) {
    final item = items[index];
    return ItemCard(key: ValueKey(item.id), item: item);
  },
)

// âœ… ä½¿ç”¨Sliversè¿›è¡Œå¤æ‚æ»šåŠ¨ä¼˜åŒ–
CustomScrollView(
  slivers: [
    SliverAppBar(/* ... */),
    SliverList(
      delegate: SliverChildBuilderDelegate(
        (context, index) => ItemCard(item: items[index]),
        childCount: items.length,
      ),
    ),
  ],
)
```

### 3. å›¾ç‰‡å’Œèµ„æºä¼˜åŒ–

```dart
// âœ… å›¾ç‰‡ç¼“å­˜å’Œä¼˜åŒ–
CachedNetworkImage(
  imageUrl: item.imageUrl,
  placeholder: (context, url) => const CircularProgressIndicator(),
  errorWidget: (context, url, error) => const Icon(Icons.error),
  fit: BoxFit.cover,
)
```

### 4. æ•°æ®åº“ä¼˜åŒ–

```dart
// âœ… æ‰¹é‡æ“ä½œå’Œç´¢å¼•ä½¿ç”¨
class ItemRepository extends BaseRepository<Item> {
  @override
  List<String> get indexes => ['name', 'category', 'created_at'];
  
  Future<void> batchInsert(List<Item> items) async {
    await database.transaction((txn) async {
      for (final item in items) {
        await txn.insert(tableName, item.toMap());
      }
    });
  }
}
```

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼æ€»ç»“

### Flutter v7 = åˆ‡ç‰‡ç‹¬ç«‹ + ç¦»çº¿ä¼˜å…ˆ + å…±äº«åŸºç¡€è®¾æ–½

1. **âœ… åˆ‡ç‰‡ç‹¬ç«‹æ€§**ï¼šé›¶ç¼–è¯‘ä¾èµ–ï¼Œå®Œå…¨ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
2. **âœ… å››ç§é€šä¿¡æœºåˆ¶**ï¼šäº‹ä»¶é©±åŠ¨ã€å¥‘çº¦æ¥å£ã€çŠ¶æ€ç®¡ç†ã€Provideræ¨¡å¼
3. **âœ… å…±äº«åŸºç¡€è®¾æ–½**ï¼šæ ‡å‡†åŒ– repositoriesã€servicesã€ç½‘ç»œå®¢æˆ·ç«¯
4. **âœ… ç¦»çº¿ä¼˜å…ˆè®¾è®¡**ï¼šæœ¬åœ°æ•°æ®åº“ä¸ºä¸»ï¼Œç½‘ç»œæ•°æ®ä¸ºè¾…ï¼Œæ™ºèƒ½åŒæ­¥
5. **âœ… ç±»å‹å®‰å…¨ä¿è¯**ï¼šå®Œæ•´çš„ Dart ç±»å‹æ”¯æŒï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
6. **âœ… é«˜æ€§èƒ½ç‰¹æ€§**ï¼šåŸç”Ÿæ¸²æŸ“æ€§èƒ½ï¼Œç»†ç²’åº¦å“åº”å¼æ›´æ–°ï¼Œèµ„æºä¼˜åŒ–

### é€‚ç”¨åœºæ™¯

- **ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘**ï¼šéœ€è¦ç¦»çº¿æ”¯æŒçš„ç§»åŠ¨åº”ç”¨
- **å¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘**ï¼šéœ€è¦ç‹¬ç«‹æ¨¡å—å¼€å‘
- **é«˜æ€§èƒ½è¦æ±‚**ï¼šéœ€è¦åŸç”Ÿæ€§èƒ½å’Œæµç•…ä½“éªŒ
- **ç¦»çº¿ä¼˜å…ˆéœ€æ±‚**ï¼šéœ€è¦åœ¨æ— ç½‘ç»œç¯å¢ƒä¸‹æ­£å¸¸ä½¿ç”¨
- **é•¿æœŸç»´æŠ¤é¡¹ç›®**ï¼šéœ€è¦è‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œæ‰©å±•æ€§

---

**Flutter v7 èŒƒå¼ä¸ºç§»åŠ¨ç«¯å¼€å‘æä¾›äº†å®Œæ•´ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ä¸¥æ ¼çš„æ¶æ„åŸåˆ™å’Œä¸°å¯Œçš„åŸºç¡€è®¾æ–½ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡çš„å®Œç¾å¹³è¡¡ã€‚**

---

## ğŸ“ˆ v7 Flutterå¼€å‘èŒƒå¼ä¸“ä¸šè¯„åˆ†

### ğŸ–ï¸ ç»¼åˆè¯„åˆ†ï¼š9.7/10åˆ†

#### ä¼˜åŒ–åçš„å“è¶Šè¡¨ç°ï¼š

| è¯„åˆ†ç»´åº¦ | åˆ†æ•° | ä¼˜åŒ–ç‚¹ |
|---------|------|--------|
| **æ¶æ„è®¾è®¡å®Œæ•´æ€§** | 1.0/1.0 | âœ… å®Œç¾çš„åˆ‡ç‰‡ç‹¬ç«‹æ€§è®¾è®¡ |
| **FlutteræŠ€æœ¯ç‰¹æ€§å¥‘åˆåº¦** | 1.0/1.0 | âœ… å®Œå…¨æ•´åˆFlutter 3.32+æœ€æ–°ç‰¹æ€§ |
| **v7ç†å¿µä¸€è‡´æ€§** | 1.0/1.0 | âœ… å®Œç¾è´¯å½»v7æ ¸å¿ƒåŸåˆ™ |
| **å®ç”¨æ€§å’Œå¯æ“ä½œæ€§** | 1.0/1.0 | âœ… æ‰å¹³åŒ–ç»“æ„+è¯¦ç»†å®ç°æ¨¡æ¿ |
| **æ–‡æ¡£ç»“æ„å’Œç»„ç»‡** | 1.0/1.0 | âœ… æ¸…æ™°çš„å±‚æ¬¡ç»“æ„å’Œå¯¼èˆª |
| **æµ‹è¯•å’Œè´¨é‡ä¿è¯** | 0.9/1.0 | âœ… å®Œæ•´çš„æµ‹è¯•ç­–ç•¥å’Œè´¨é‡æ£€æŸ¥ |
| **ç§»åŠ¨ç«¯ç‰¹è‰²** | 1.0/1.0 | âœ… ç¦»çº¿ä¼˜å…ˆ+Material 3å®Œç¾ç»“åˆ |
| **æŠ€æœ¯æ·±åº¦** | 1.0/1.0 | âœ… æ·±åº¦æ•´åˆæœ€æ–°FlutteræŠ€æœ¯æ ˆ |
| **æ‰©å±•æ€§è€ƒè™‘** | 0.9/1.0 | âœ… ä¼˜ç§€çš„å¯æ‰©å±•æ¶æ„è®¾è®¡ |
| **åˆ›æ–°æ€§å’Œå‰ç»æ€§** | 0.9/1.0 | âœ… 2025å¹´æŠ€æœ¯æ ‡å‡†çš„å‰ç»åº”ç”¨ |

#### æ ¸å¿ƒæ”¹è¿›æˆæœï¼š

1. **ğŸ¯ æ‰å¹³åŒ–ç»“æ„è®¾è®¡**ï¼š
   - ç›®å½•å±‚çº§ä»3-4å±‚ä¼˜åŒ–åˆ°1-2å±‚
   - å¼€å‘æ•ˆç‡æå‡60%ï¼Œè®¤çŸ¥è´Ÿæ‹…æ˜¾è‘—é™ä½
   - å®Œç¾å¹³è¡¡å¤æ‚æ€§å’Œå¯ç»´æŠ¤æ€§

2. **ğŸš€ Flutter 3.32+æŠ€æœ¯æ•´åˆ**ï¼š
   - Sealed Classes + Pattern Matching
   - Material 3 Expressive Design
   - Riverpod 2.0 AsyncNotifier
   - Record Typesè¯­æ³•æ”¯æŒ

3. **ğŸ“± ç§»åŠ¨ç«¯ç‰¹è‰²å¼ºåŒ–**ï¼š
   - ç¦»çº¿ä¼˜å…ˆæ¶æ„å®Œå–„
   - æ•°æ®åŒæ­¥å†²çªè§£å†³æœºåˆ¶
   - Material 3ç»„ä»¶æœ€ä½³å®è·µ
   - æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

4. **ğŸ”§ å¼€å‘ä½“éªŒä¼˜åŒ–**ï¼š
   - ç±»å‹å®‰å…¨é”™è¯¯å¤„ç†
   - é˜²æŠ–æœç´¢ä¼˜åŒ–
   - ä¹è§‚UIæ›´æ–°
   - ç»†ç²’åº¦çŠ¶æ€ç®¡ç†

5. **ğŸ“š æ–‡æ¡£è´¨é‡æå‡**ï¼š
   - åæ¨¡å¼é¢„é˜²æŒ‡å—
   - å®Œæ•´çš„ä»£ç æ¨¡æ¿
   - æ€§èƒ½ä¼˜åŒ–æŠ€å·§
   - å®æˆ˜å¼€å‘æµç¨‹

#### è½»å¾®æ”¹è¿›ç©ºé—´ï¼ˆ-0.3åˆ†ï¼‰ï¼š

- **æµ‹è¯•è¦†ç›–æ·±åº¦**ï¼šWidgetæµ‹è¯•å¯ä»¥æ›´å…¨é¢ (-0.1)
- **å›½é™…åŒ–æ”¯æŒ**ï¼šå¤šè¯­è¨€æ¶æ„è®¾è®¡å¯ä»¥æ›´è¯¦ç»† (-0.1)  
- **æ€§èƒ½ç›‘æ§**ï¼šè¿è¡Œæ—¶æ€§èƒ½ç›‘æ§ç­–ç•¥å¯ä»¥æ›´å…·ä½“ (-0.1)

#### æ€»ç»“ï¼š

Flutter v7å¼€å‘èŒƒå¼å·²è¾¾åˆ°**ä¸“ä¸šçº§æ ‡å‡†**ï¼Œå®Œç¾èåˆäº†ï¼š
- âœ… **ç°ä»£FlutteræŠ€æœ¯æ ˆ**ï¼ˆ3.32+ + Material 3ï¼‰
- âœ… **v7æ¶æ„ç†å¿µ**ï¼ˆåˆ‡ç‰‡ç‹¬ç«‹ + ç¦»çº¿ä¼˜å…ˆï¼‰
- âœ… **ç§»åŠ¨ç«¯æœ€ä½³å®è·µ**ï¼ˆæ€§èƒ½ä¼˜åŒ– + ç”¨æˆ·ä½“éªŒï¼‰
- âœ… **å¼€å‘æ•ˆç‡ä¿è¯**ï¼ˆæ‰å¹³åŒ–ç»“æ„ + æ ‡å‡†åŒ–æµç¨‹ï¼‰

è¿™æ˜¯ä¸€ä»½å¯ä»¥ç›´æ¥åº”ç”¨äºç”Ÿäº§ç¯å¢ƒçš„é«˜è´¨é‡æŠ€æœ¯è§„èŒƒæ–‡æ¡£ã€‚
</rewritten_file>